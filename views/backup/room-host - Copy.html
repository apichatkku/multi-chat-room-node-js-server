<html >
    <head>
        <title>แอปพลิเคชันเพื่อการเรียนรู้การเขียนโปรแกรม</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css">
        <link rel="stylesheet" type="text/css" href="css/main.css">
        <script src="/socket.io/socket.io.js"></script>
        <script src="/jquery/1.11.2/jquery.min.js"></script>
        <script src="/js/client/sha1.js"></script>
        <style>
            table{
                background-color: #fff;
                font-size: 26px;
            }
            td{
                padding: 10px 10px;
            }
            button{
                align-content: left;
            }
        </style>
    </head>
    <body>
        <div align="center">
            <h1></h1>
            <table>
                <tr>
                    <td>
                            <nav id="member-list-box" class="list" style="width:150px;height:400px">
                            </nav>
                    </td>
                    <td>
                            <nav id="text-list-box" class="list" style="width:800px;height:400px">
                            </nav>
                    </td>
                </tr>
            </table>
        </div>
        <center><button onclick="next()">ถัดไป</button></center>
        <script>
            var socket = io();

            window.onload = function(){
                if(sessionStorage.getItem('token')==null){
                    window.location.replace("/login");
                    return;
                }
                let url = new URL(window.location.href);
                let roomKey = url.searchParams.get("roomKey");
                console.log(roomKey);
                if(roomKey !== null){
                    $('h1').text("รหัสห้อง : "+roomKey);
                }
                if(sessionStorage.getItem('token')!==null){
                    console.log(sessionStorage.getItem('token'));
                }
                if(sessionStorage.getItem('room')!==null){
                    console.log(sessionStorage.getItem('room'));
                    socket.emit('enter room', {room:sessionStorage.getItem('room'),token:sessionStorage.getItem('token')});
                }
            }

            //receive
            socket.on('room member list', function(data) {
                $('nav#member-list-box').text('');
                for(let i in data){
                    $('nav#member-list-box').append($('<p>').text("#"+(parseInt(i)+1)+" "+data[i]));
                }
            });

            socket.on('room', function(data) {
                $('nav#text-list-box').append($('<p>').text(data));
            });

            socket.on('quistion', function(data) {
                $('nav#text-list-box').append($('<p>').text(data));
            });

            //send
            function next(){
                socket.emit('quistion', {room:sessionStorage.getItem('room'),token:sessionStorage.getItem('token')});
            }
            

        </script>
    </body>
</html>